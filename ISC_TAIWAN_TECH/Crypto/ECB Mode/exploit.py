from pwn import *

nc = remote('isc.taiwan-te.ch', 17601)
# nc = remote('localhost', 5566)

nc.sendlineafter('Command:', 'register')
print('[+] send: register')
payload = 'A' * 4
nc.sendlineafter('Username:', payload)
print('[+] send: ' + payload)
# user=AAAA&admin=
# N

nc.recvuntil('Token: ')
msg = nc.recv(64)
AdminToken = msg[:32]
for i in range(0, len(msg), 32):
    print('[+] Recv token ' + msg[i:i+32])
print('[+] AdminToken ' + AdminToken)

nc.sendlineafter('Command: ', 'register')
print('[+] send: register')
payload = 'A'*11 + 'Y' + 'O'*15 + 'O'*16
nc.sendlineafter('Username: ', payload)
print('[+] send: ' + payload)
# user=AAAAAAAAAAA
# YOOOOOOOOOOOOOOO
# OOOOOOOOOOOOOOOO
# &admin=N

nc.recvuntil('Token: ')
msg = nc.recv(32 * 4)
YToken = msg[32:64]
OToken = msg[64:96]
for i in range(0, len(msg), 32):
    print('[+] Recv token ' + msg[i:i+32])
print('[+] YToken ' + YToken)
print('[+] OToken ' + OToken)

nc.sendlineafter('Command: ', 'login')
print('[+] send: login')
payload = AdminToken + YToken + OToken * 4
nc.sendlineafter('Token: ', payload)
print('[+] send: token ' + payload)

# user=AAAA&admin= 
# YOOOOOOOOOOOOOOO
# OOOOOOOOOOOOOOOO
# OOOOOOOOOOOOOOOO
# OOOOOOOOOOOOOOOO
# OOOOOOOOOOOOOOOO

nc.interactive()
