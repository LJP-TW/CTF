#!/usr/bin/php
<?php
// sudo apt-get install php

$secret = "i don't know";

function set_user($user_data)
{
    global $user, $secret;

    $user = [$user_data['name'], $user_data['admin']];

    $data = json_encode($user);
    // $sig = hash_hmac('sha512', $data, $secret);
    $sig = True;
    $all = base64_encode(json_encode(['sig' => $sig, 'data' => $data]));
    return $all;
}

$error = null;
$my_user_data = ['name' => 'LJP', 'admin' => True];
$myall = set_user($my_user_data);

function load_user()
{
    global $secret, $error, $myall;

    $unserialized = json_decode(base64_decode($myall), true);
    $r = hash_hmac('sha512', $unserialized['data'], $secret) != $unserialized['sig'];

    if(hash_hmac('sha512', $unserialized['data'], $secret) != $unserialized['sig']) {
        $error = 'Invalid session';
        return false;
    }

    $data = json_decode($unserialized['data'], true);
    return [
        'name' => $data[0],
        'admin' => $data[1]
    ];
}

$user = load_user();

if ($user)
{
    print($myall . "\n");
    print($user['name'] . "\n");
    print($user['admin'] . "\n");
    printf("You %s admin!\n", $user['admin'] ? "are" : "are not");
}
else
    print($error);
